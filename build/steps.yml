steps:
- template: init.yml


- powershell: ./build.ps1
  displayName: "Building"
  workingDirectory: $(System.DefaultWorkingDirectory)/build


- powershell: ./test.ps1
  displayName: "Testing"
  workingDirectory: $(System.DefaultWorkingDirectory)/build
  condition: and(succeeded(), ne(variables['Skip.Tests'], 'true'))


- powershell: ./pack.ps1
  displayName: "Pack NuGets"
  workingDirectory: $(System.DefaultWorkingDirectory)/build



##
# VisualStudio Extension can't be built from the build script.
# Both extensions are hence built here. 
##

- task: CmdLine@1
  displayName: 'Pack VS Code extension'
  inputs:
    filename: vsce
    arguments: package
    workingFolder: '$(System.DefaultWorkingDirectory)/src/VSCodeExtension'


- task: VSBuild@1
  displayName: 'Pack VisualStudio extension'
  inputs:
    solution: '$(System.DefaultWorkingDirectory)/VisualStudioExtension.sln'
    msbuildArgs: >
      /p:DefineConstants=$(Assembly.Constants) 
      /p:AssemblyVersion=$(Assembly.Version)
    configuration: $(Build.Configuration)


- template: wrap-up.yml
