steps:
- template: init.yml


- bash: ./build.sh
  displayName: "Building Q# compiler"
  workingDirectory: $(Compiler.WorkingDirectory)/build


- bash: ./test.sh
  displayName: "Testing Q# compiler"
  workingDirectory: $(Compiler.WorkingDirectory)/build
  condition: and(succeeded(), ne(variables['Skip.Tests'], 'true'))


- bash: ./pack.sh
  displayName: "Pack Q# compiler"
  workingDirectory: $(Compiler.WorkingDirectory)/build



##
# VisualStudio Extension can't be built from the build script.
##
- task: NuGetCommand@2
  displayName: 'NuGet restore VisualStudioExtension'
  inputs:
    restoreSolution: '$(Compiler.WorkingDirectory)/VisualStudioExtension.sln'

- task: VSBuild@1
  displayName: 'Build VisualStudioExtension'
  inputs:
    solution: '$(Compiler.WorkingDirectory)/VisualStudioExtension.sln'
    msbuildArgs: >
      /p:DefineConstants=$(Assembly.Constants) 
      /p:AssemblyVersion=$(Assembly.Version)
    configuration: $(Build.Configuration)


- template: wrap-up.yml
